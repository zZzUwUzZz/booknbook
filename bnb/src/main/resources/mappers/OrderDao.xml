<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.cjcs.bnb.dao.OrderDao">

<!--수희-->
    <select id="getOrderListGroupByOId" parameterType="String" resultType="Map">
        <!-- Map객체에 넣을 때는 아래처럼 as "키이름" 지정해줘야 함 -->
        SELECT o_id as "o_id",
               o_date as "o_date",
               first_title as "first_title",
               COUNT(*)-1 as "book_sorts_minus_one",
               order_status as "order_status",
               o_delivery_sort as "o_delivery_sort"
        FROM (SELECT o_id,
                    o_date,
                    FIRST_VALUE(b_title) OVER(PARTITION BY o_id) AS first_title,
                    order_status,
                    o_delivery_sort
              FROM order_list
              WHERE o_c_id = #{c_id})
        GROUP BY o_id, o_date, first_title, order_status, o_delivery_sort
        ORDER BY o_id DESC
    </select>

    <select id="getOrderInfoByOId" parameterType="Integer" resultType="Map">
        SELECT o_id as "o_id",
               o_date as "o_date",
               o_delivery_sort as "o_delivery_sort",
               o_recip_addr as "o_recip_addr",
               o_recip_name as "o_recip_name",
               o_recip_phone as "o_recip_phone"
        FROM O
        WHERE o_id=#{o_id}
    </select>

<!--예림-->
    <!-- 오늘 판매 수 카운트 -->
    <select id="getTodaySellCnt" resultType="int">
        select count(*)
        from order_list
        where to_char(o_date, 'yy/mm/dd') = '23/09/02' and order_sort = '구매' and s_id = 'seller003'
        <!-- where to_char(o_date, 'yy/mm/dd') = to_char(sysdate, 'yy/mm/dd') and order_sort = '구매' and s_id = #{s_id} -->
    </select>

    <!-- 오늘 대여 수 카운트 -->
    <select id="getTodayRentCnt" resultType="int">
        select count(*)
        from order_list
        where to_char(o_date, 'yy/mm/dd') = '23/09/02' and order_sort = '대여' and s_id = 'seller003'
        <!-- where to_char(o_date, 'yy/mm/dd') = to_char(sysdate, 'yy/mm/dd') and order_sort = '대여' and s_id = #{s_id} -->
    </select>

    <!-- 오늘 대여 예약 수 카운트 -->
    <select id="getTodayRentResCnt" parameterType="RentalReservationDto" resultType="Integer">
        select count(*)
        from Rental_Res
        where to_char(rr_reqdate, 'yy/mm/dd') = '23/09/03' and rr_s_id = 'seller002'
        <!-- where to_char(rr_reqdate, 'yy/mm/dd') = to_char(sysdate, 'yy/mm/dd') and rr_s_id = #{rr_s_id} -->
    </select>

    <!-- 오늘 배송 준비중 카운트 -->
    <select id="getTodayDeliveryPrepare" parameterType="SellerDto" resultType="Integer">
        SELECT count(*)
        from order_list
        where order_status_id = 2 and s_id = 'seller001'
        <!-- where order_status_id = 4 and deliverydate = sysdate and s_id = #{s_id} -->
    </select>

    <!-- 오늘 배송중 카운트 -->
    <select id="getTodayDeliverShip" parameterType="SellerDto" resultType="Integer">
        SELECT count(*)
        from order_list
        where order_status_id = 1 and s_id = 'seller003'
        <!-- where order_status_id = 6 and deliverydate = sysdate and s_id = #{s_id} -->
    </select>

    <!-- 오늘 배송 완료 카운트 -->
    <select id="getTodayDeliverComplete" parameterType="SellerDto" resultType="Integer">
        SELECT count(*)
        from order_list
        where order_status_id = 1 and s_id = 'seller002'
        <!-- where order_status_id = 7 and deliverydate = sysdate and s_id = #{s_id} -->
    </select>

    <!-- 한 달간 취소 요청 카운트 -->
    <select id="getMonthCancelRequest" parameterType="SellerDto" resultType="Integer">
        select count(*)
        from order_list
        where o_date between to_char(sysdate-30, 'yy/mm/dd') and to_char(sysdate, 'yy/mm/dd') and order_status_id = '2' and s_id = 'seller001'
        <!-- where o_date between to_char(sysdate-30, 'yy/mm/dd') and to_char(sysdate, 'yy/mm/dd') and order_status_id = '2' and s_id = #{s_id} -->
    </select>

    <!-- 한 달간 반품/교환 카운트 -->
    <select id="getMonthReturnRequest" parameterType="SellerDto" resultType="Integer">
        select count(*)
        from Ref_Exch
        where re_reqdate between to_char(sysdate-30, 'yy/mm/dd') and to_char(sysdate, 'yy/mm/dd') and re_s_id = 'seller001'
        <!-- where re_reqdate between to_char(sysdate-30, 'yy/mm/dd') and to_char(sysdate, 'yy/mm/dd') and re_s_id = #{s_id} -->
    </select>

</mapper><!-- 주문취소 -->
	<update id="orderCancle">
		update p_order set orderState = '주문취소' where orderId = #{orderId}
	</update>	

	<!-- 주문 상품 정보(주문취소) -->
	<select id="getOrderItemInfo" resultType="com.cjcs.bnb.dao.OrderItemDto">
	
		select * from p_orderItem
		where orderId = #{orderId}
	
	</select>
	
	<!-- 주문 정보(주문 취소) -->
	<select id="getOrder" resultType="com.cjcs.bnb.dto.OrderDto">
	
		select * from p_order        
		where orderId = #{orderId} 
	<!-- 더미데이터 만들기
        회원가입 되어 있는 회원id와( m_id ) 주문자id확인 ( p_order )
        또는 무조건 로그인으로 회원 확인된 상태 데이터 생성 불 필요 아직 구성 중... 
     -->

	</select>